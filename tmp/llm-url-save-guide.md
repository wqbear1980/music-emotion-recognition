# 服务地址保存功能使用指南

## ✅ 已修复

服务地址现在可以**持久化保存**了！即使刷新页面或重新打开配置面板，你修改的地址也不会丢失。

---

## 📝 使用步骤

### 第1步：打开配置面板

点击顶部工具栏的「🤖 LLM 配置」按钮

### 第2步：进入本地模式

- **LLM模式**：选择「本地（Local）」
- **服务类型**：选择「Ollama」

### 第3步：编辑服务地址

1. 找到「服务地址」输入框
2. 点击右侧的「**编辑**」按钮
3. 输入框变为可编辑状态（白色背景）
4. 输入你的服务地址：
   ```
   https://a1b2-c3d4-e5f6.ngrok-free.app
   ```
5. 点击「**确定」」按钮

**✅ 此时服务地址已自动保存到浏览器！**

### 第4步：验证保存

刷新页面或重新打开「🤖 LLM 配置」面板，你会发现：
- 服务地址依然显示你刚才输入的地址
- 不会恢复为默认地址

---

## 💡 工作原理

### 自动保存机制

```
用户点击"编辑"
    ↓
输入自定义地址
    ↓
点击"确定"
    ↓
自动保存到 localStorage ✅
    ↓
刷新页面后自动加载 ✅
```

### 持久化存储

服务地址保存在浏览器的 **localStorage** 中：
- 键名：`llm_custom_base_url`
- 位置：浏览器的本地存储
- 优点：刷新页面、关闭浏览器都不会丢失

---

## 🎨 使用示例

### 示例1：使用 ngrok 地址

```
服务地址: https://a1b2-c3d4-e5f6.ngrok-free.app
```

### 示例2：使用 frp 地址

```
服务地址: http://your-server.com:6000
```

### 示例3：使用本地局域网地址（仅限同一网络）

```
服务地址: http://192.168.1.13:11434
```

---

## 🔧 高级功能

### 清除保存的地址

如果你想恢复默认地址：

**方法1：手动清除**
1. 打开浏览器开发者工具（F12）
2. 进入「Application」或「存储」标签
3. 找到「Local Storage」
4. 删除 `llm_custom_base_url` 键

**方法2：在代码中清除**
打开浏览器控制台，输入：
```javascript
localStorage.removeItem('llm_custom_base_url');
```

### 查看保存的地址

打开浏览器控制台，输入：
```javascript
console.log(localStorage.getItem('llm_custom_base_url'));
```

---

## 🐛 故障排除

### 问题1：修改后刷新页面又变回默认

**可能原因**：
- 点击了「编辑」但没有点击「确定」
- 输入了空地址

**解决**：
1. 重新编辑地址
2. 确保地址不为空
3. 点击「确定」保存

### 问题2：保存的地址不生效

**检查清单**：
- [ ] 是否点击了「确定」按钮？
- [ ] 地址格式是否正确？（例如：`https://xxx.ngrok-free.app`）
- [ ] 点击「测试连接」是否成功？

**解决**：
1. 检查服务地址格式
2. 确保ngrok或服务正在运行
3. 点击「测试连接」验证

### 问题3：多个配置面板冲突

如果你在多个标签页打开了配置面板：

**注意**：localStorage 是全局共享的
- 在一个标签页修改会影响其他标签页
- 建议只在一个标签页配置

---

## 📋 完整配置流程（以 ngrok 为例）

```
1. 启动 Ollama
   ↓
2. 启动 ngrok
   ↓
3. 复制 ngrok 地址（如：https://xxx.ngrok-free.app）
   ↓
4. 打开「🤖 LLM 配置」
   ↓
5. 选择「本地（Local）」+「Ollama」
   ↓
6. 点击「编辑」
   ↓
7. 输入 ngrok 地址
   ↓
8. 点击「确定」✅（自动保存）
   ↓
9. 点击「测试连接」
   ↓
10. 选择模型
   ↓
11. 点击「保存配置」
   ↓
12. 开始使用！
```

---

## 🎉 功能特点

### ✅ 自动保存
- 点击「确定」后自动保存
- 无需额外操作

### ✅ 持久化存储
- 刷新页面不会丢失
- 关闭浏览器后依然存在

### ✅ 跨页面共享
- 同一个浏览器中多个标签页共享配置
- 只需配置一次，到处可用

### ✅ 用户友好
- 清晰的视觉反馈
- 简单的操作流程

---

## 💡 最佳实践

### 推荐做法

1. **配置前测试**
   - 先测试服务地址是否可访问
   - 确认后再保存到配置

2. **记录备用地址**
   - 保存多个可用地址（如ngrok的不同域名）
   - 方便快速切换

3. **定期检查**
   - 定期测试连接状态
   - 确保服务正常运行

### 注意事项

- ⚠️ localStorage 有大小限制（通常5-10MB）
- ⚠️ 清除浏览器数据会删除保存的地址
- ⚠️ 不同浏览器之间不共享配置

---

## ❓ 常见问题

**Q: 保存的地址会过期吗？**
A: 不会，localStorage 中的数据会一直保存，直到你手动清除或清除浏览器数据。

**Q: 可以在不同电脑上共享配置吗？**
A: 不可以。localStorage 是浏览器本地的存储，不同电脑之间不共享。

**Q: 我需要重新输入地址吗？**
A: 不需要。配置一次后，刷新页面或重新打开配置面板都会自动加载保存的地址。

**Q: 如何知道地址已保存成功？**
A: 刷新页面后，地址依然显示为你输入的值，说明保存成功。

---

## 🚀 现在开始使用

1. 打开「🤖 LLM 配置」
2. 编辑服务地址
3. 点击「确定」保存
4. 享受持久化的配置体验！

---

如有任何问题，随时告诉我！
